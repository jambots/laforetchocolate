<html>
<head>
<meta http-equiv = "content-type" content = "application/xhtml+xml; charset = UTF-8" />
<meta content = 'width = device-width, initial-scale = 1.0, maximum-scale = 1.0, user-scalable = 0' name = 'viewport' /><meta name = "viewport" content = "width = device-width, maximum-scale = 1.0, initial-scale = 1.0"><meta name = "apple-mobile-web-app-capable" content = "yes"><meta name = "title" content = "Cycle of Destruction" /><meta name = "description" content = "Card game based on the 5 Chinese elements" />
<title>la for&circ;t chocolate</title>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.1/jquery.min.js"></script>
<script src="phonegap.js"></script>
<script src="childbrowser.js"></script>
<script type="text/javascript" src="iscroll-lite.js"></script>
<link rel = "stylesheet" type = "text/css" href = "reset.css">
<style>
@font-face {
    font-family: 'sack';
    src: url('sackh.ttf') format('truetype');
    font-weight:normal;
    font-style:normal;
}
*{
font-family: 'sack';
-webkit-user-select:none;
}
#landscapeMain{
  background-color:#555;
  position:absolute;
  top:0;
  width:100%;
  height:100%;
  }
#portraitMain{
  background-color:#555;
  position:absolute;
  top:0;
  width:100%;
  height:100%;
  }
#thumbsUi{
  background-color:#555;
  position:absolute;
  top:0;
  width:100%;
  height:100%;
  }
#thumbsNavTop{
  position:absolute;
  background: -webkit-linear-gradient(top, #4a4a4a 0%, #b2b2b2 2%, #898989 4%, #525252 50%, #1d1d1d 98%, #161616 100%); 
  }
#thumbsNavBottom{
  position:absolute;
  background: -webkit-linear-gradient(top, #4a4a4a 0%, #b2b2b2 2%, #898989 4%, #525252 50%, #1d1d1d 98%, #161616 100%); 
  }
#thumbsHolder{
  background-color:#f88;
  width:100%;
  position:absolute;
  top:0;
  }
#thumbsScroller{
  background-color:#66f;
  width:100%;
  }
#setSelectDim{
  top:0;
  left:0;
  position:absolute;
  background-color:rgba(0,0,0,.5);
  width:100%;
  height:100%;
  }
#setSelectModal{
  position:absolute;
  background-color:#f00;
  width:200px;
  height:300px;
  top:10px;
  left:10px;
  }
#setSelectNavTop{
  width:100%;
  background: -webkit-linear-gradient(top, #4a4a4a 0%, #b2b2b2 2%, #898989 4%, #525252 50%, #1d1d1d 98%, #161616 100%); 
  }

#setSelectHolder{
  position:absolute;
  background-color:#666;
  width:200px;
  height:250px;
  top:50px;
  left:0px;
  }
#setSelectScroller{
  background-color:#ccc;
  width:180px;
  }
#rotorUi{
  display:none;
  background-color:#ff0;
  width:100%;
  height:100%;
  position:absolute;
  top:0;
  overflow:hidden;
  }
#rotor{
  position:absolute;
  }
#rotorNavTop{
  background: -webkit-linear-gradient(top, #4a4a4a 0%, #b2b2b2 2%, #898989 4%, #525252 50%, #1d1d1d 98%, #161616 100%); 
  width:100%;
  position:absolute;
  }
#rotorNavBottom{
  background: -webkit-linear-gradient(top, #4a4a4a 0%, #b2b2b2 2%, #898989 4%, #525252 50%, #1d1d1d 98%, #161616 100%); 
  width:100%;
  position:absolute;
  }
// butts
#portraitRotor{
  display:none;
  position:absolute;
  }
#infoButton{
  position:absolute;
  top:0;
  }
#thumbsButton{
  position:absolute;
  top:0;
  }
#setSelectButton{
  position:absolute;
  top:0;
  }
#setSelectCancel{
  position:absolute;
  top:0;
  }
</style>
<script>
var ddiv;
var sScroll;
var tScroll;
var sdiv
function init(){
  ddiv=document.getElementById('debugDiv');
  sdiv=document.getElementById('setSelectScroller'); 
  dbug('init()');
  loadData();
  dbuga('loadData() ran');
  clearInterval(dimensionInterval);
  dimensionInterval=setInterval('dimensionTick()', 1000);
  }
var dimensionInterval;
var ww=0;
var wh=0;
var orient="unset";
function dimensionTick(){
  if((ww!=window.innerWidth)||(wh!=window.innerHeight)){
    measure();
    }
  }
var grid=3;
var cellsDown=10;
var cellsAcross=33;
var deviceWidth=330;
function measure(){
  ww=window.innerWidth;
  wh=window.innerHeight;
  var prevOrient=orient;
  if(ww>wh){
    orient="landscape";
    deviceWidth=wh;
    document.getElementById('portraitMain').style.top=wh+"px";
    document.getElementById('landscapeMain').style.top=0+"px";
    }
  else{
    orient="portrait";
    deviceWidth=ww;
    document.getElementById('portraitMain').style.top=0+"px";
    document.getElementById('landscapeMain').style.top=wh+"px";
    }
  if(orient != prevOrient){
    //dbuga('orient: '+orient);
    }
  cellsAcross=32;
  if(deviceWidth>540){cellsAcross=48;}
  var newGrid=deviceWidth/cellsAcross;
  if(grid != newGrid){// init or resize somehow, not on rotate
    grid=newGrid;
    cellsDown=Math.floor(wh/grid);
    dbuga(ww+' '+wh);
    dbuga(cellsAcross+' '+cellsDown);
    populate();
    }
  }
function selectSet(setNum){
  dbuga("selectSet("+setNum+")");
  selectedSetNum=setNum;
  updateSet();
  hideSetSelect();
  }
var selectUp=true;
function hideRotor(){
  document.getElementById('thumbsUi').style.top=0+"px";
  document.getElementById('rotorUi').style.top=wh+"px";
  }
function updateSet(){
  updateSelectButtons();
  updateThumbButtons();
  updateRotor();
  updateCoverflow();
  }
function updateCoverflow(){
  }
function roundRect(canv, color, background, label, labelColor, font, pointy){
  var ctx=canv.getContext('2d');
  var rad=grid/2;
  var pad=grid/8;
  ctx.lineWidth=grid/8; 
  ctx.strokeStyle=color;
  ctx.beginPath();
  ctx.arc(canv.width-rad-pad,rad+pad, rad, pi*1.5, pi*2, false);
  ctx.arc(canv.width-rad-pad,canv.height-rad-pad, rad, pi*0, pi*.5, false);
  if(pointy){
    ctx.lineTo(pad+canv.height/2,canv.height-pad);
    ctx.lineTo(0,canv.height/2);
    ctx.lineTo(pad+canv.height/2,pad);
    }
  else{
    ctx.arc(rad+pad,canv.height-rad-pad, rad, pi*.5, pi*1, false);
    ctx.arc(rad+pad,rad+pad, rad, pi*1, pi*1.5, false);
    }
  ctx.closePath();
  ctx.stroke();
  ctx.fillStyle=background;
  ctx.fill();
  ctx.fillStyle=labelColor;
  ctx.textBaseline= "middle";  
  ctx.textAlign= "center";  
  ctx.font=font;  
  ctx.fillText(label,canv.width/2,canv.height/2);
  }
function populate(){
  dbuga('populate()');
  var modalWidth=32;	
  var selectWidth=28;	
  var modalMargin=(cellsAcross-modalWidth)/2;
  //dbuga(modalMargin);
  var htmlString="";
  htmlString+='<div style="height:'+grid*2+'px; width:'+grid*selectWidth+'px;float:left;"></div>';
  for (var s=0; s<setKeys.length; s++){
    htmlString+='<div style="height:'+grid*4+'px; width:'+grid*selectWidth+'px; padding-left:'+grid*2+'px; float:left;">';
    htmlString+='<canvas onMouseDown="setTap('+s+')" onMouseUp="setRelease('+s+')" height='+Math.floor(grid*4)+' width='+Math.floor(grid*selectWidth)+' id="canv_'+s+'" style="position:absolute;"></canvas>';
    htmlString+='</div>';
    if(s==0){htmlString+='<div style="height:'+grid*2+'px; width:'+grid*selectWidth+'px;float:left;"></div>';}
    sets[setKeys[s]].sort();
    }
  sdiv.innerHTML=htmlString;
 
  document.getElementById("setSelectModal").style.width=grid*modalWidth+"px";
  document.getElementById("setSelectModal").style.height=(grid*(cellsDown-2*modalMargin))+"px";
  document.getElementById("setSelectModal").style.top=grid*modalMargin+"px";
  document.getElementById("setSelectModal").style.left=grid*modalMargin+"px";

  document.getElementById("setSelectHolder").style.width=grid*modalWidth+"px";
  document.getElementById("setSelectHolder").style.height=(wh-grid*4-grid*modalMargin*2)+"px";
  document.getElementById("setSelectHolder").style.top=grid*4+"px";
  document.getElementById("setSelectScroller").style.width=grid*modalWidth+"px";

  sdiv.style.height=(setKeys.length+1.5)*grid*4+"px";

  document.getElementById("thumbsHolder").style.height=(wh-grid*8)+"px";
  document.getElementById("thumbsHolder").style.top=grid*4+"px";
  document.getElementById("thumbsNavTop").style.height=grid*4+"px";
  document.getElementById("thumbsNavTop").style.width=ww+"px";
  document.getElementById("thumbsNavBottom").style.top=(wh-grid*4)+"px";
  document.getElementById("thumbsNavBottom").style.height=grid*4+"px";
  document.getElementById("thumbsNavBottom").style.width=ww+"px";

  document.getElementById("rotor").style.top=(grid*4)+"px";
  document.getElementById("rotorNavTop").style.height=grid*4+"px";
  document.getElementById("rotorNavTop").style.width=ww+"px";
  document.getElementById("rotorNavBottom").style.top=(wh-grid*4)+"px";
  document.getElementById("rotorNavBottom").style.height=grid*4+"px";
  document.getElementById("rotorNavBottom").style.width=ww+"px";

  document.getElementById("setSelectNavTop").style.height=grid*4+"px";

  updateSet();
  tScroll=new iScroll("thumbsHolder");
  sScroll=new iScroll("setSelectHolder");

  // buttons  



  var canv=document.getElementById("setSelectCancel");
  canv.width=Math.floor(grid*6);
  canv.height=Math.floor(grid*3);
  canv.style.top=grid*.5+"px";
  canv.style.left=grid*.5+"px";
  roundRect(canv, "#666", "#222", "Cancel", "#fff", Math.floor(grid*1.25)+"px sack", false);

  var canv=document.getElementById("infoButton");
  canv.width=Math.floor(grid*3);
  canv.height=Math.floor(grid*3);
  canv.style.top=grid*.5+"px";
  canv.style.left=(ww-grid*4.5)+"px";
  var ctx=canv.getContext('2d');
  ctx.beginPath();
  ctx.arc(grid*1.5, grid*1.5,grid*1,0,pi*2,true);
  ctx.fillStyle="white";
  ctx.fill();
  ctx.font = "italic";
  roundRect(canv, "rgba(0,0,0,0)", "rgba(255,0,0,0)", "i", "#444", "bold italic "+Math.floor(grid*1.5)+"px Georgia", false);

  var canv=document.getElementById("setSelectButton");
  canv.width=Math.floor(grid*4);
  canv.height=Math.floor(grid*3);
  canv.style.top=grid*.5+"px";
  canv.style.left=grid*.5+"px";
  roundRect(canv, "#666", "#222", "", "", "", false);
  var ctx=canv.getContext('2d');
  ctx.lineWidth=grid/4; 
  ctx.strokeStyle="white";
  ctx.beginPath();
  ctx.moveTo(grid,grid*1);
  ctx.lineTo(grid*3,grid*1);
  ctx.moveTo(grid,grid*1.5);
  ctx.lineTo(grid*3,grid*1.5);
  ctx.moveTo(grid,grid*2.0);
  ctx.lineTo(grid*3,grid*2.0);
  ctx.stroke();
  ctx.strokeStyle="black";
  ctx.beginPath();
  ctx.moveTo(grid*1.5,grid*.5);
  ctx.lineTo(grid*1.5,grid*2.5);
  ctx.stroke();
  }
var setTappedNum=0;
var setTappedMs=-1;
var thumbTappedNum=0;
var thumbTappedMs=-1;
var rotorTappedNum=0;
var rotorTappedMs=-1;
function rotorTap(i){
  rotorTappedNum=i;
  var d = new Date();
  rotorTappedMs=d.getTime();
  }
function rotorRelease(i){
  if(rotorTappedMs==-1){
    return false;
    }
  var d = new Date();
  var deltaT=d.getTime()-rotorTappedMs;
  if(deltaT<400){
    //selectRotor(rotorTappedNum);
    //dbuga("rotorRelease("+i+") "+deltaT);
    }
  rotorTappedMs=-1;
  }
function thumbTap(i){
  thumbTappedNum=i;
  //dbuga("thumbTap("+i+") ");
  var d = new Date();
  thumbTappedMs=d.getTime();
  }
function thumbRelease(i){
  if(thumbTappedMs==-1){
    return false;
    }
  var d = new Date();
  var deltaT=d.getTime()-thumbTappedMs;
  if(deltaT<400){
    //dbuga("thumbRelease("+i+") "+thumbTappedNum);
    selectThumb(thumbTappedNum);
    }
  thumbTappedMs=-1;
  }
function setTap(i){
  //dbuga("setTap("+i+") ");

  setTappedNum=i;
  var d = new Date();
  setTappedMs=d.getTime();
  }
function setRelease(i){
  if(setTappedMs==-1){
    return false;
    }
  var d = new Date();
  var deltaT=d.getTime()-setTappedMs;
  if(deltaT<400){
    //dbuga("setRelease("+i+") "+deltaT);
    selectSet(setTappedNum);
    }
  setTappedMs=-1;
  }
function selectThumb(num){
  //dbuga("selectThumb("+num+")");
  document.getElementById('thumbsUi').style.top=wh+"px";
  document.getElementById('rotorUi').style.top=0+"px";
  selectedThumbNum=num;
  }

function hideSetSelect(){
  dbuga("hideSetSelect() called" +selectUp);
  selectUp=false; 
  document.getElementById('setSelectDim').style.top=wh+"px";
  }
function showSetSelect(){
  dbuga("showSetSelect()" +selectUp);
  selectUp=true;
  document.getElementById('setSelectDim').style.top=0+"px";
  }

function updateThumbButtons(){
  var cols=cellsAcross/16;
  var selectedSetKey=setKeys[selectedSetNum];
  var set=sets[selectedSetKey];
  //selectedSetKey=selectedSetKey.replace("%20", " ");
  var imgWidth=Math.floor(ww/cols);
  var imgHeight=Math.floor(imgWidth*4.2/3);
  var htmlString="";
  var rows=1+Math.floor((set.length-1)/cols);
  //dbuga("rows="+rows);
  for (var i=0; i<set.length; i++){
    htmlString+='<img onMouseDown="thumbTap('+i+')" onMouseUp="thumbRelease('+i+')" width='+imgWidth+' src="http://laforetchocolate.com/app/chocolate/'+selectedSetKey+'/'+ set[i]+'" />';
    }

  document.getElementById("thumbsScroller").innerHTML=htmlString;
  document.getElementById("thumbsScroller").style.height=(imgHeight*rows)+"px";
  }
function updateRotor(){
  var selectedSetKey=setKeys[selectedSetNum];
  var set=sets[selectedSetKey];
  //selectedSetKey=selectedSetKey.replace("%20", " ");
  
  var imgWidth=ww;
  var imgHeight=Math.floor(imgWidth*4/3);


  var htmlString="";
  for (var i=0; i<set.length; i++){
    htmlString+='<img onMouseDown="rotorTap('+i+')" onMouseUp="rotorRelease('+i+')" height='+imgHeight+' width='+imgWidth+' src="http://laforetchocolate.com/app/chocolate/'+selectedSetKey+'/'+ set[i]+'" />';
    }

  document.getElementById("rotor").innerHTML=htmlString;
  document.getElementById("rotor").style.width=(imgWidth*set.length)+"px";
  }
var animTimeout;
function animTick(){
  window.clearTimeout(animTimeout);
  animTimeout=window.setTimeout("animTick()", 25);
  }
function updateSelectButtons(){
 for (var s=0; s<setKeys.length; s++){
    var canv=document.getElementById("canv_"+s);
    canv.width=canv.width;
    var ctx=canv.getContext('2d');
    var rad=grid/2;
    var pad=grid/8;
    ctx.lineWidth=grid/8; 
    ctx.strokeStyle="#444";
    ctx.beginPath();

    if(s==0){
      ctx.moveTo(pad+rad,pad);
      ctx.lineTo(canv.width-rad-pad,pad);
      ctx.arc(canv.width-rad-pad,rad+pad, rad, pi*1.5, pi*2, false);
      ctx.arc(canv.width-rad-pad,canv.height-rad-pad, rad, pi*0, pi*.5, false);
      ctx.arc(rad+pad,canv.height-rad-pad, rad, pi*.5, pi*1, false);
      ctx.arc(rad+pad,rad+pad, rad, pi*1, pi*1.5, false);
      }
    else if(s==1){
      ctx.arc(rad+pad,rad+pad, rad, pi*1, pi*1.5, false);
      ctx.arc(canv.width-rad-pad,rad+pad, rad, pi*1.5, pi*2, false);
      ctx.lineTo(canv.width-pad,canv.height-pad);
      ctx.lineTo(pad,canv.height-pad);
      ctx.lineTo(pad,pad+rad);
      }
    else if(s==setKeys.length-1){
      ctx.moveTo(pad,pad);
      ctx.lineTo(canv.width-pad,pad);
      ctx.arc(canv.width-rad-pad,canv.height-rad-pad, rad, pi*0, pi*.5, false);
      ctx.arc(rad+pad,canv.height-rad-pad, rad, pi*.5, pi*1, false);
      ctx.lineTo(pad,pad);
      }
    else{
      ctx.moveTo(pad,pad);
      ctx.lineTo(canv.width-pad,pad);
      ctx.lineTo(canv.width-pad,canv.height-pad);
      ctx.lineTo(pad,canv.height-pad);
      ctx.lineTo(pad,pad);
      }
    ctx.stroke();
    ctx.fillStyle="white";
    ctx.fill();

    var temp=setKeys[s].split("_");
    var title=temp[1];
    ctx.fillStyle="#333";
    ctx.font=Math.floor(grid*2)+"px sack";
    ctx.textBaseline= "middle";  
    ctx.textAlign= "left";    
    ctx.fillText(title,grid*1,canv.height/2);

    

    if(selectedSetNum==s){
      ctx.lineWidth=grid/3;
      ctx.strokeStyle="#555";
      ctx.beginPath();
      ctx.moveTo(canv.width-grid*2, grid*2);
      ctx.lineTo(canv.width-grid*1.5, grid*2.75);
      ctx.lineTo(canv.width-grid*1, grid*1.25);
      ctx.stroke();


      var canv=document.getElementById("thumbsButton");
      canv.width=Math.floor(grid*12);
      canv.height=Math.floor(grid*3);
      canv.style.top=grid*.5+"px";
      canv.style.left=grid*.5+"px";
      roundRect(canv, "#666", "#222", title, "#fff", Math.floor(grid*1.25)+"px sack", true);


      }
    }
  }
var pi=Math.PI;
function loadData(){
  $(document).ready(function(){
      $.getJSON('config.json', function(json) {
         //dbuga(JSON.stringify(json));
         parseData(json);
         //debugData();
         });
       });
    }

var setKeys=["9999_Favorites"];
var sets={"9999_Favorites":[]};
var selectedSetNum=0;
var selectedThumbNum=0;
function parseData(theData){
  var itemData=theData.config.assets;
  var allKeys=Object.keys(itemData);
  for (var k=0; k<allKeys.length; k++){
    var thisKey=allKeys[k];
    var tempArray=thisKey.split('/');
    var thisSet=tempArray[1];
    var thisItem=tempArray[2];
    if(inArray(thisSet,setKeys)==false){
      setKeys.push(thisSet);
      //dbuga('<b>'+thisSet+'</b>');
      sets[thisSet]=[];
      }
    sets[thisSet].push(thisItem);
    }
  setKeys.sort();
  setKeys.reverse();
  
  for (var s=0; s<setKeys.length; s++){
    sets[setKeys[s]].sort();
    }
  selectedSetNum=1;
  animTimeout=window.setTimeout("animTick()", 25);
  }

function debugData(){
  for (var s=0; s<setKeys.length; s++){
    var setKey=setKeys[s];
    //dbuga('<b>'+setKey+'</b>');
    var set=sets[setKey];
    for (var i=0; i<set.length; i++){
      //dbuga(' '+set[i]);
      }
    }
  }
function inArray(needle, haystack) {
  var length = haystack.length;
  for(var i = 0; i < length; i++) {
    if(haystack[i] == needle) return true;
    }
  return false;
  }
function dbug(str) {
  if(str==''){
    ddiv.style.display = "none";
    }
  else{ddiv.style.display = "block";}
  ddiv.innerHTML = str;
  }
function dbuga(str) {
  ddiv.style.display = "block";
  ddiv.innerHTML += "<br />"+str;
  }
function rnd(range) {
  return Math.floor(Math.random()*range);
  }
</script>
</head>
<body onload="init()">
<div id="landscapeMain">
</div>
<div id="portraitMain">
  <div id="thumbsUi">
    <div id="thumbsNavTop"   style="background-color:blue;">
      <canvas id="setSelectButton" ontouchend="window.setTimeout('showSetSelect()', 100)"></canvas>
      <div id="thumbsLabel"></div>

      <canvas id="infoButton" onMouseDown="showInfo()"></canvas>
    </div>
    <div id="thumbsNavBottom">
    </div>
    <div id="thumbsHolder">
      <div id="thumbsScroller"></div>
    </div>
    <div id="setSelectDim">
      <div id="setSelectModal">
      <div id="setSelectNavTop">
        <canvas id="setSelectCancel" ontouchend="window.setTimeout('hideSetSelect()', 100)"></canvas>
      </div>
        <div id="setSelectHolder">
          <div id="setSelectScroller"></div>
        </div>
      </div>
    </div>
  </div>
  <! end of thumbsUi>
  <div id="rotorUi">
    <div id="rotor"></div>
    <div id="rotorNavTop" style="background-color:#0f0;">
      <canvas id="thumbsButton" onMouseDown="hideRotor()"></canvas>
    </div>
    <div id="rotorNavBottom"></div>
  </div><! end of rotorUi>
  <div id="debugDiv" style="top:0px;left:100px; position:absolute;"></div>
</div><! end of portraitMain>
</body>
</html>